#
# Ahoy configuration file.
# http://www.ahoycli.com/
#
# Test fixture for YAML updating with comment preservation
#
ahoyapi: v2

commands:
  # Build command
  build:
    usage: Build or rebuild the project.
    cmd: |
      # Reset the project
      ahoy reset
      # Start the stack
      ahoy up --build --force-recreate

  # Information command
  info:
    usage: Show information about this project.
    cmd: |
      COMPOSE_PROJECT_NAME=${COMPOSE_PROJECT_NAME:-${PWD##*/}} \
      ahoy cli ./scripts/vortex/info.sh "$@"

  # Database operations
  down:
    usage: 'Stop and remove containers, images, volumes and networks.'
    cmd: docker compose down --remove-orphans --volumes

  up:
    usage: 'Start containers.'
    cmd: docker compose down --remove-orphans --volumes "$@"

  stop:
    usage: 'Stop and containers.'
    cmd: docker compose down --remove-orphans --volumes $@

  stop-escaped:
    usage: 'Stop and containers.'
    cmd: ahoy cli "vendor/bin/drush -l \${VORTEX_LOCALDEV_URL} $*"

  stop-multiline:
    usage: 'Stop and containers.'
    cmd: |
      docker compose down --remove-orphans
      docker compose down --remove-orphans --volumes $@
      docker compose down --remove-orphans --volumes "$@"
      docker compose down --remove-orphans

  debug:
    usage: Enable PHP Xdebug.
    cmd: ahoy cli php -v | grep -q Xdebug || XDEBUG_ENABLE=true ahoy up cli php nginx && ahoy cli php -v | grep -q Xdebug && echo "Enabled debug configuration. Use 'ahoy up' to disable."

# Override entrypoint to alter default behavior of Ahoy.
entrypoint:
  - bash
  - '-c'
  - -e
  # Exit the script if any statement returns a non-true return value.
  - |
    bash -e -c "$0" "$@"
  - '{{cmd}}'
  - '{{name}}'
